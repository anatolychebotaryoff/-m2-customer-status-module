<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
/* @var $this Enterprise_TargetRule_Block_Catalog_Product_List_Related */
?>
<?php
// Enhanced Google Ecommerce Variables
$currentPosition = 1;
?>
<?php if ($this->hasItems()):?>
    <div class="block block-related first">
        <div class="block-title">
            <strong>
                <span><?php echo $this->__('Related Products') ?></span>
            </strong>
        </div>
        <div class="block-content">
            <?php $i=0; foreach($this->getItemCollection() as $_item): ?>
                <?php if ($i++ % $this->getColumnCount() == 0): ?>
                    <ul class="box-content">
                <?php endif ?>
                <li class="item<?php if (($i - 1) % $this->getColumnCount() == 0):?> first<?php elseif ($i % $this->getColumnCount() == 0): ?> last<?php endif; ?>">
                    <?php
                    $itemBlock = $this->getChild('catalog.product.related.item')->setItem($_item)->setPosition($i);
                    echo $itemBlock->toHtml();
                    ?>
                </li>
                <script type="text/javascript">
                    try {
                        ga('ec:addImpression', {
                            'id'        :   '<?php echo $_item->getId() ?>',
                            'name'      :   '<?php echo $this->jsQuoteEscape($_item->getName()) ?>',
                            'category'  :   '<?php echo ($_item->getCategory() ? $this->jsQuoteEscape($_item->getCategory()->getName()) : null) ?>',
                            'list'      :   'Related Products TargetRule',
                            'position'  :   '<?php echo $currentPosition++ ?>'
                        });
                    } catch (e) {}
                </script>
                <?php if ($i % $this->getColumnCount() == 0 || $i == $this->getItemsCount()): ?>
                    </ul>
                <?php endif ?>
            <?php endforeach ?>
            <script type="text/javascript">
                try {
                    ga('send', 'event', 'catalog', 'impression', {'nonInteraction': true});
                } catch (e) {}
            </script>
            <script type="text/javascript">addEvent(window, 'load', function(){ decorateGeneric($$('.box-related ul.box-content'), ['odd','even','first','last']); });</script>
        </div>
    </div>
<?php endif;?>
