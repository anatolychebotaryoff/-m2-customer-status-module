<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper( 'catalog/output' ); ?>
<?php $_helperUV = $this->helper( 'uswf_universalvariable' ); ?>
<?php $_canShowClass = false; ?>
<?php $_product = $this->getProduct(); ?>
<?php $package_qty = $_product->getPackageQty(); ?>
<?php if ( is_numeric( $package_qty ) && (int) $package_qty != 1 ) : ?>
	<?php $variant = $package_qty . 'pk'; ?>
<?php else : ?>
	<?php $variant = 'single'; ?>
<?php endif; ?>
<?php $brand = ( $_product->getAttributeText( 'manufacturer' ) ? $this->jsQuoteEscape( $_product->getAttributeText( 'manufacturer' ) ) : null ); ?>
<?php $productCategory = $_helperUV->getAttributeValue( $_product->getId(), 'item_type' ); ?>
<?php $_product_data = array(
	'variant'  => $variant,
	'brand'    => $brand,
	'category' => $productCategory
);
?>
<?php $_noLongerSold = $_product->getNotForSale() ?>

<div class="container">
	<div class="row pdp--masthead">

		<div class="col-md-5 no-padding pdp-media-column">
			<?php echo $this->getChildHtml( 'media' ) ?>
		</div>

		<div class="col-md-7 no-padding pdp-info-column">
			<div class="pdp--title">
				<div class="col-md-12">
					<div id="title-wrap-container-bottom">
						<div id="title-wrap">
							<?php echo $this->getChildHtml( 'upsell_products' ) ?>
							<h2 class="product--title"><?php echo $this->getProduct()->getName(); ?></h2>
							<?php $this->helper( 'uswf_yotpo' )->showBottomline( $this, $_product ); ?>
							<?php $this->helper( 'uswf_yotpo' )->showQABottomline( $this, $_product ); ?>
							<div class="cust-title" style="display:none;"></div>
							<script type="text/javascript">
								addEvent(window, 'load', function () {
									var params = document.location.search.toQueryParams(),
										custTitle = jQuery('.cust-title');
									if (params['cust-title'] !== undefined && custTitle.length) {
										custTitle.text(decodeURIComponent(params['cust-title'].replace(/\+/g, "%20"))).css('display', '');
									}
								});
							</script>

						</div>
					</div>
				</div>
			</div>
			<div class="no-padding">
				<div class="col-md-12">
					<?php if ( $_product->getTypeId() == "grouped" ): ?>
						<?php echo $this->getChildHtml( 'grouped_add_to_cart' ); ?>
						<?php echo $this->getChildHtml( 'product_type_data' ) ?>
					<?php else: ?>
						<form action="<?php echo $this->getSubmitUrl( $_product ) ?>" method="post"
							  id="product_addtocart_form"<?php if ( $_product->getOptions() ): ?> enctype="multipart/form-data"<?php endif; ?>>
							<div class="col-md-6 simple-price-display">
								<div class="row">
									<?php echo $this->getPriceHtml( $_product ); ?>
								</div>
							</div>
							<div class="col-md-6 simple-qty-display">
								<div class="qty-block">
									<label for="qty"><?php echo $this->__( 'Qty:' ) ?></label>
									<input type="text" name="qty" id="qty" maxlength="12"
										   value="<?php echo $this->getProductDefaultQty() * 1 ?>"
										   title="<?php echo $this->__( 'Qty' ) ?>" class="input-text simple-qty"/>
								</div>
							</div>
							<?php $this->getChild( 'addtocart' )->setProductData( $_product_data ); ?>
							<?php echo $this->getChildHtml( 'addtocart' ); ?>
							<?php echo $this->getChildHtml( 'product_type_data' ); ?>
						</form>
					<?php endif; ?>
					<div class="col-md-12">
						<div class="product--description">
							<?php echo $_helper->productAttribute( $_product, nl2br( $_product->getShortDescription() ), 'short_description' ) ?>
						</div>
					</div>
				</div>
			</div>
		</div>



		<div class="masthead--trusted" style="right: 30px">
			<!--                <img src="http://placehold.it/260x40&text=trusted%20seller%20icon" alt="">-->
		</div>
	</div> <!-- /.masthead -->

	<?php echo $this->getChildHtml( 'info_tabs' ) ?>

	<div class="pdp--related">
		<div class="pdp--section pdp--section__history">
			<div>
				<h2 class="section--title">Related Products</h2>

				<script id="history-template" type="text/x-handlebars-template">
					{{#items}}
					<article class="history--wrap col-12 col-xs-12 col-sm-12 col-md-3 col-lg-3">
						<a href="{{{item_url}}}">
							<div class="history--entry">
								<img class="entry--img" src="{{{img_url}}}" alt="image of {{{title}}}">
								<h4 class="entry--title">{{{title}}}</h4>
								<div class="entry--reviews">{{{reviews}}}</div>
								<p class="entry--price"><span class="entry--price-value">{{{price}}}</span>{{#if
									msrp}} <span
											class="entry--price-msrp-label">MSRP:</span> <span
											class="entry--price-msrp-value">{{{msrp}}}</span>{{/if}}
								</p>
							</div>
						</a>
					</article>
					{{/items}}
				</script>

				<div id="PDPHistory"></div>
			</div>

		</div> <!-- /.history -->
		<?php echo $this->getChildHtml( 'relatedProducts' ); ?>
	</div>

	<?php if($this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-content1" )->toHtml() != ""): ?>
		<div class="pdp--section pdp--section__content1">
			<?php echo $this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-content1" )->toHtml() ?>
		</div>
	<?php endif; ?>
	<?php if($this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-infographic1" )->toHtml() != ""): ?>
		<div class="pdp--section pdp--section__infographic1">
			<?php echo $this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-infographic1" )->toHtml() ?>
		</div>
	<?php endif; ?>
	<?php if($this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-content2" )->toHtml() != ""): ?>
		<div class="pdp--section pdp--section__content2">
			<?php echo $this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-content2" )->toHtml() ?>
		</div>
	<?php endif; ?>
	<?php if($this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-infographic2" )->toHtml() != ""): ?>
		<div class="pdp--section pdp--section__infographic2">
			<?php echo $this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-infographic2" )->toHtml() ?>
		</div>
	<?php endif; ?>
	<?php if($this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-content3" )->toHtml() != ""): ?>
		<div class="pdp--section pdp--section__content3">
			<?php echo $this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-content3" )->toHtml() ?>
		</div>
	<?php endif; ?>
	<?php if($this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-infographic3" )->toHtml() != ""): ?>
		<div class="pdp--section pdp--section__infographic3">
			<?php echo $this->getLayout()->createBlock( 'cms/block' )->setBlockId( $_product->getSku() . "-infographic3" )->toHtml() ?>
		</div>
	<?php endif; ?>


</div> <!-- /.container -->
<script type="text/javascript">
	addEvent(window, 'load', function () {
		window.optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
		var sliderOptions = { //iOS Slider
			snapToChildren: true,
			scrollbar: true,
			scrollbarHide: false,
			desktopClickDrag: true,
			scrollbarLocation: 'bottom',
			scrollbarHeight: '6px',
			scrollbarBackground: 'none',
			scrollbarBorder: '1px solid #999',
			scrollbarMargin: '0 30px 16px 30px',
			scrollbarOpacity: '0.75'
		};
	});
</script>

<div class="container">
	<div class="pdp--section pdp--section__tier1 col-md-12 no-padding">
		<?php
		if ( $this->getProduct()->getAttributeText( 'manufacturer' ) == 'Tier1' ) {
			echo $this->getChildHtml( 'tier1difference_block' );
		}
		?>
	</div> <!-- /.tier1 -->
</div> <!-- /.container -->

<?php if ( ! $_product->isGrouped() ): ?>
	<script type="text/javascript">
		//<![CDATA[
		addEvent(window, 'load', function () {
			window.productAddToCartForm = new VarienForm('product_addtocart_form');
			window.productAddToCartForm.submit = function (button, url) {
				if (this.validator.validate()) {
					var form = this.form;
					var oldUrl = form.action;

					if (url) {
						form.action = url;
					}
					var e = null;
					try {
						this.form.submit();
					} catch (e) {
					}
					this.form.action = oldUrl;
					if (e) {
						throw e;
					}

					if (button && button != 'undefined') {
						button.disabled = true;
					}
				}
			}.bind(window.productAddToCartForm);

			window.productAddToCartForm.submitLight = function (button, url) {
				if (this.validator) {
					var nv = Validation.methods;
					delete Validation.methods['required-entry'];
					delete Validation.methods['validate-one-required'];
					delete Validation.methods['validate-one-required-by-name'];
					// Remove custom datetime validators
					for (var methodName in Validation.methods) {
						if (methodName.match(/^validate-datetime-.*/i)) {
							delete Validation.methods[methodName];
						}
					}

					if (this.validator.validate()) {
						if (url) {
							this.form.action = url;
						}
						this.form.submit();
					}
					Object.extend(Validation.methods, nv);
				}
			}.bind(window.productAddToCartForm);
		});
		//]]>
	</script>
<?php endif; ?>
