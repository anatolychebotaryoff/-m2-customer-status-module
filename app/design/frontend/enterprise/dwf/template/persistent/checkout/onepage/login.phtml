<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Customer onepage checkout login form template
 *
 * @see app/design/frontend/base/default/template/checkout/onepage/login.phtml
 */
/** @var $this Mage_Checkout_Block_Onepage_Login */
?>
<div class="col2-set">
    <div class="col-1">
        <div class="headplate"><span><?php echo $this->__('New Customers'); ?></span></div>
        <div class="colbody">
            </br>
            </br>
            <ul class="form-list">
                <li class="control">
                    <input type="radio" name="checkout_method" id="login:register" value="register"<?php if ($this->getQuote()->getCheckoutMethod() == Mage_Checkout_Model_Type_Onepage::METHOD_REGISTER || !$this->getQuote()->isAllowedGuestCheckout()): ?> checked="checked"<?php endif ?> class="radio invisible" />
                    <label class="invisible" for="login:register"><?php echo $this->__('Register') ?></label>
                    <button id="registerBtn" class="checkoutButton" onclick="manualSetMethod(this, 'login:register');">Create Account</button>
                </li>
            </ul>
            <?php if( $this->getQuote()->isAllowedGuestCheckout() ): ?>
                <div class="infotext"><?php echo $this->__('Allows fast and easy future check outs and  access to your order history and status.'); ?></div>
                <ul class="form-list">
                    <li class="control">
                        <input type="radio" name="checkout_method" id="login:guest" value="guest"<?php if($this->getQuote()->getCheckoutMethod()==Mage_Checkout_Model_Type_Onepage::METHOD_GUEST): ?> checked="checked"<?php endif; ?> class="radio invisible" />
                        <label class="invisible" for="login:guest"><?php echo $this->__('Checkout as Guest') ?></label>
                        <button id="guestBtn" class="checkoutButton" onclick="manualSetMethod(this, 'login:guest');"><?php echo $this->__('Guest Checkout'); ?></button>
                    </li>
                </ul>
            <?php endif; ?>
            <div class="buttons-set invisible">
                <p class="required">&nbsp;</p>
                <?php if ($this->getQuote()->isAllowedGuestCheckout()): ?>
                    <button id="onepage-guest-register-button" type="button" class="button" onclick="checkout.setMethod();"><span><span><?php echo $this->__('Continue') ?></span></span></button>
                <?php elseif ($this->helper('checkout')->isCustomerMustBeLogged()): ?>
                    <button id="onepage-guest-register-button" type="button" class="button" onclick="window.location='<?php echo $this->helper('checkout/url')->getRegistrationUrl();?>'"><span><span><?php echo $this->__('Register') ?></span></span></button>
                <?php else: ?>
                    <form action="<?php echo $this->getUrl('persistent/index/saveMethod'); ?>">
                        <button id="onepage-guest-register-button" type="submit" class="button"><span><span><?php echo $this->__('Register') ?></span></span></button>
                    </form>
                <?php endif; ?>
            </div>
        </div>
    </div>
    <?php echo $this->getChildHtml('login_before')?>
    <div class="col-2">
        <div class="headplate"><span><?php echo $this->__('Returning Customers'); ?></span></div>
        <div class="colbody">
            <?php echo $this->getMessagesBlock()->getGroupedHtml() ?>
            <form id="login-form" action="<?php echo $this->getPostAction() ?>" method="post">
                <fieldset>
                    <ul class="form-list">
                        <li>
                            <label for="login-email" class="required"><?php echo $this->__('Email Address') ?></label>
                            <div class="input-box">
                                <input type="email" class="input-text required-entry validate-email" id="login-email" name="login[username]" value="<?php echo $this->escapeHtml($this->getUsername()) ?>" />
                            </div>
                        </li>
                        <li>
                            <label for="login-password" class="required"><?php echo $this->__('Password') ?></label>
                            <div class="input-box">
                                <input type="password" class="input-text required-entry" id="login-password" name="login[password]" />
                            </div>
                        </li>
                        <?php echo $this->getChildHtml('form.additional.info'); ?>
                        <?php echo $this->getChildHtml('persistent.remember.me'); ?>
                    </ul>
                    <input name="context" type="hidden" value="checkout" />
                </fieldset>
            </form>
            <div class="buttons-set">
                <button type="submit" class="checkoutButton" onclick="onepageLogin(this)"><?php echo $this->__('Login'); ?></button>
                <a href="<?php echo $this->getUrl('customer/account/forgotpassword'); ?>" ><?php echo $this->__('Forgot your password?'); ?></a>
                <a class="hintlord" href="#" >
                    <?php echo $this->__('Was your account created before October 1st 2013?'); ?>
                    <span>
                        <img class="callout" src="<?php echo $this->getSkinUrl('images/callout.gif'); ?>">
                       <strong>Note:</strong> <?php echo $this->__('Accounts are a new and improved feature on our site! If you have not ordered with
                        us since October of 2013 you will not have an account to log into. Please register
                        today at checkout or call us for assistance.'); ?>
                    </span>
                </a>
            </div>
        </div>
    </div>
</div>
<!--<div class="col2-set">
    <div class="col-1">
    </div>
    <div class="col-2">
    </div>
</div>-->
<script type="text/javascript">
//<![CDATA[
addEvent(window, 'load', function() {
    var loginForm = new VarienForm('login-form', true);
    $('login-email').observe('keypress', bindLoginPost);
    $('login-password').observe('keypress', bindLoginPost);
    function bindLoginPost(evt) {
        if (evt.keyCode == Event.KEY_RETURN) {
            loginForm.submit();
        }
    }

    function onepageLogin(button) {
        if (loginForm.validator && loginForm.validator.validate()) {
            button.disabled = true;
            loginForm.submit();
        }
    }
});
//]]>
</script>
<?php
    $registerParam = $this->getRequest()->getParam('register');
    if ($registerParam || $registerParam === ''):
?>
    <script type="text/javascript">
    //<![CDATA[
    addEvent(window, 'load', function() {
        if ($('login:register')) {
            $('login:register').checked = true;
            checkout.setMethod();
        }
    });
    //]]>
    </script>
<?php endif; ?>
<script type="text/javascript">
    addEvent(window, 'load', function() {
        function manualSetMethod(element, method) {
            $(method).click();
            $('onepage-guest-register-button').click();
        }
    });
</script>
