<?php
/**
 * Magento Enterprise Edition
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magento Enterprise Edition License
 * that is bundled with this package in the file LICENSE_EE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://www.magentocommerce.com/license/enterprise-edition
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     enterprise_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://www.magentocommerce.com/license/enterprise-edition
 */
/** @var $this Enterprise_TargetRule_Block_Catalog_Product_Item */
$_item = $this->getItem();
$_item_data = $this->getItemData();
$_helperUV = $this->helper('uswf_universalvariable');
$_categoryData = $_helperUV->getAttributeValue($_item->getId(), 'item_type');
?>
<?php if ($_item): ?>
    <?php if($_item->getSpecial_from_date() &&  $_item->getSpecial_to_date()) : ?>
        <?php
            $date_from_price = strtotime($this->formatDate($_item->getSpecial_from_date()));
            $date_to_price = strtotime($this->formatDate($_item->getSpecial_to_date()));
            $date_current_price = strtotime(date('m/d/y'));
        ?>
        <?php if($date_from_price <= $date_current_price && $date_to_price >= $date_current_price): ?>
            <span class="date-sale" style="left: 10px;">
                <img src="<?php echo $this->getSkinUrl()?>/images/icon-sale.png" />
            </span>
        <?php endif; ?>
    <?php endif; ?>
    <div class="item-inner">
        <div class="product">
            <div class="product-details">
                <a href="<?php echo $_item->getProductUrl() ?>" title="<?php echo $this->escapeHtml($_item->getName()) ?>" class="product-image" onclick="onProductClick('<?php echo $_item->getSku() ?>', '<?php echo $this->jsQuoteEscape($_item->getName()) ?>', 'Related Products TargetRule', '<?php echo $_categoryData ?>' , '<?php echo $_item_data['variant'] ?>', '<?php echo $_item_data['brand'] ?>' );">
                    <img height="100" src="<?php echo $this->helper('catalog/image')->init($_item, 'thumbnail')->resize(100) ?>" alt="<?php echo $this->escapeHtml($_item->getName()) ?>" />
                </a>
                <p class="product-name"><a href="<?php echo $_item->getProductUrl() ?>" onclick="onProductClick('<?php echo $_item->getSku() ?>', '<?php echo $this->jsQuoteEscape($_item->getName()) ?>', 'Related Products TargetRule', '<?php echo $_categoryData ?>' , '<?php echo $_item_data['variant'] ?>', '<?php echo $_item_data['brand'] ?>' );"><?php echo $this->escapeHtml($_item->getName()) ?></a></p>
                <?php
                $_product_new = Mage::getModel('catalog/product')->load($_item->getId());
                $_noLongerSold = $_product_new->getNotForSale();
                if (!$_noLongerSold)
                {
                    echo $this->getPriceHtml($_product_new, true, '-related');
                }
                ?>
                <div class="yotpo-bottomLine-wrapper">
                    <span class="hidden yotpo-data" data-url="<?php echo $_product_new->getProductUrl() ?>"></span>
                    <?php $this->helper('uswf_yotpo')->showBottomline($this, $_product_new); ?>
                </div>
            </div>
            <?php if (!$_noLongerSold): ?>
                <a class="button btn-cart" title="<?php echo $this->__('Add to Cart') ?>" href="<?php echo $this->getSubmitUrl($_item); ?>" onclick="onAddToCart('<?php echo $_item->getSku() ?>', '<?php echo $this->jsQuoteEscape($_item->getName()) ?>', '<?php echo $_item->getFinalPrice() ?>', '1', '<?php echo $_categoryData ?>' , '<?php echo $_item_data['variant'] ?>', '<?php echo $_item_data['brand'] ?>')">
                    <span><?php echo $this->__('Add to Cart') ?></span>
                </a>
            <?php else: ?>
                <a class="button details" title="<?php echo $this->__('View Details') ?>" href="<?php echo $_product_new->getProductUrl(); ?>">
                    <span><?php echo $this->__('View Details') ?></span>
                </a>
            <?php endif; ?>
        </div>
    </div>
<?php endif; // $_item ?>

